var m=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var w=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var E=(c,i)=>{for(var e in i)m(c,e,{get:i[e],enumerable:!0})},S=(c,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of w(i))!v.call(c,s)&&s!==e&&m(c,s,{get:()=>i[s],enumerable:!(t=b(i,s))||t.enumerable});return c};var x=c=>S(m({},"__esModule",{value:!0}),c);var f={};E(f,{default:()=>h});module.exports=x(f);var n=require("obsidian"),y={pubmedEnabled:!0,arxivEnabled:!0,wikipediaEnabled:!0,maxResults:5},h=class extends n.Plugin{async onload(){await this.loadSettings(),this.addRibbonIcon("search","Search research databases",()=>{new u(this.app,this).open()}),this.addCommand({id:"search-selection",name:"Search selected text",editorCallback:(i,e)=>{let t=i.getSelection();t?new u(this.app,this,t).open():new n.Notice("Please select some text first")}}),this.addCommand({id:"pubmed-search",name:"Search biomedical literature",callback:()=>{new u(this.app,this,"","pubmed").open()}}),this.addCommand({id:"arxiv-search",name:"Search preprints",callback:()=>{new u(this.app,this,"","arxiv").open()}}),this.addCommand({id:"wikipedia-search",name:"Search encyclopedia",callback:()=>{new u(this.app,this,"","wikipedia").open()}}),this.addSettingTab(new g(this.app,this))}async loadSettings(){this.settings=Object.assign({},y,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},u=class extends n.Modal{constructor(e,t,s="",r="all"){super(e);this.resultsContainer=null;this.plugin=t,this.query=s,this.source=r}onOpen(){let{contentEl:e}=this;e.empty(),e.addClass("builtsimple-modal"),e.createEl("h2",{text:"Search research databases"});let s=e.createDiv({cls:"builtsimple-input-container"}).createEl("input",{type:"text",placeholder:"Enter search query...",value:this.query,cls:"builtsimple-search-input"}),a=e.createDiv({cls:"builtsimple-source-selector"}).createEl("select",{cls:"builtsimple-source-select"});[{value:"all",label:"All sources"},{value:"pubmed",label:"PubMed"},{value:"arxiv",label:"ArXiv"},{value:"wikipedia",label:"Wikipedia"}].forEach(o=>{let d=a.createEl("option",{value:o.value,text:o.label});o.value===this.source&&(d.selected=!0)});let p=e.createEl("button",{text:"Search",cls:"builtsimple-search-btn"});p.onclick=()=>{let o=s.value,d=a.value;o&&this.performSearch(o,d)},this.resultsContainer=e.createDiv({cls:"builtsimple-results-container"}),this.query&&(s.value=this.query,this.performSearch(this.query,this.source))}async performSearch(e,t){if(!this.resultsContainer)return;this.resultsContainer.empty(),this.resultsContainer.createEl("p",{text:"Searching..."});let s=[],r=this.plugin.settings.maxResults;try{if((t==="all"||t==="pubmed")&&this.plugin.settings.pubmedEnabled){let a=await this.searchPubMed(e,r);s.push(...a.map(l=>({...l,source:"PubMed"})))}if((t==="all"||t==="arxiv")&&this.plugin.settings.arxivEnabled){let a=await this.searchArxiv(e,r);s.push(...a.map(l=>({...l,source:"ArXiv"})))}if((t==="all"||t==="wikipedia")&&this.plugin.settings.wikipediaEnabled){let a=await this.searchWikipedia(e,r);s.push(...a.map(l=>({...l,source:"Wikipedia"})))}this.displayResults(s,this.resultsContainer)}catch(a){this.resultsContainer.empty(),this.resultsContainer.createEl("p",{cls:"builtsimple-error"}).setText(`Error: ${a instanceof Error?a.message:"Unknown error"}`)}}async searchPubMed(e,t){return(await(0,n.requestUrl)({url:`https://pubmed.built-simple.ai/search?q=${encodeURIComponent(e)}&limit=${t}`,method:"GET"})).json.results||[]}async searchArxiv(e,t){return(await(0,n.requestUrl)({url:`https://arxiv.built-simple.ai/search?q=${encodeURIComponent(e)}&limit=${t}`,method:"GET"})).json.results||[]}async searchWikipedia(e,t){return(await(0,n.requestUrl)({url:`https://wikipedia.built-simple.ai/search?q=${encodeURIComponent(e)}&limit=${t}`,method:"GET"})).json.results||[]}displayResults(e,t){if(t.empty(),e.length===0){t.createEl("p",{text:"No results found."});return}e.forEach(s=>{let r=t.createDiv({cls:"builtsimple-result"});if(r.createEl("span",{text:s.source||"Unknown",cls:"builtsimple-badge"}),r.createEl("strong",{text:s.title||"Untitled",cls:"builtsimple-title"}),s.abstract||s.snippet||s.summary){let l=(s.abstract||s.snippet||s.summary||"").substring(0,200)+"...";r.createEl("p",{text:l,cls:"builtsimple-snippet"})}let a=r.createEl("button",{text:"Insert citation",cls:"builtsimple-insert-btn"});a.onclick=()=>{this.insertCitation(s)}})}insertCitation(e){let t=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(t){let s=this.formatCitation(e);t.editor.replaceSelection(s),new n.Notice("Citation inserted!"),this.close()}}formatCitation(e){var p,o;let t=e.title||"Untitled",s=((p=e.authors)==null?void 0:p.join(", "))||"Unknown",r=e.year||((o=e.date)==null?void 0:o.substring(0,4))||"",a=e.url||e.link||"",l=e.source;return l==="PubMed"?`> **${t}**
> ${s} (${r})
> [PubMed](${a})

`:l==="ArXiv"?`> **${t}**
> ${s} (${r})
> [ArXiv](${a})

`:`> **${t}**
> [Wikipedia](${a})

`}onClose(){let{contentEl:e}=this;e.empty()}},g=class extends n.PluginSettingTab{constructor(i,e){super(i,e),this.plugin=e}display(){let{containerEl:i}=this;i.empty(),new n.Setting(i).setName("Data sources").setHeading(),new n.Setting(i).setName("Pubmed").setDesc("Search biomedical literature.").addToggle(e=>e.setValue(this.plugin.settings.pubmedEnabled).onChange(async t=>{this.plugin.settings.pubmedEnabled=t,await this.plugin.saveSettings()})),new n.Setting(i).setName("Arxiv").setDesc("Search preprints.").addToggle(e=>e.setValue(this.plugin.settings.arxivEnabled).onChange(async t=>{this.plugin.settings.arxivEnabled=t,await this.plugin.saveSettings()})),new n.Setting(i).setName("Wikipedia").setDesc("Search encyclopedia articles.").addToggle(e=>e.setValue(this.plugin.settings.wikipediaEnabled).onChange(async t=>{this.plugin.settings.wikipediaEnabled=t,await this.plugin.saveSettings()})),new n.Setting(i).setName("Results per source").setDesc("Maximum number of results to show from each source.").addSlider(e=>e.setLimits(1,20,1).setValue(this.plugin.settings.maxResults).setDynamicTooltip().onChange(async t=>{this.plugin.settings.maxResults=t,await this.plugin.saveSettings()}))}};
