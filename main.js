var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var v=Object.prototype.hasOwnProperty;var w=(c,s)=>{for(var e in s)g(c,e,{get:s[e],enumerable:!0})},E=(c,s,e,t)=>{if(s&&typeof s=="object"||typeof s=="function")for(let i of x(s))!v.call(c,i)&&i!==e&&g(c,i,{get:()=>s[i],enumerable:!(t=y(s,i))||t.enumerable});return c};var S=c=>E(g({},"__esModule",{value:!0}),c);var k={};w(k,{default:()=>h});module.exports=S(k);var n=require("obsidian"),f={pubmedEnabled:!0,arxivEnabled:!0,wikipediaEnabled:!0,maxResults:5},h=class extends n.Plugin{async onload(){await this.loadSettings(),this.addRibbonIcon("search","Built Simple Research",async()=>{new u(this.app,this).open()}),this.addCommand({id:"search-selection",name:"Search selected text",editorCallback:async(s,e)=>{let t=s.getSelection();t?new u(this.app,this,t).open():new n.Notice("Please select some text first")}}),this.addCommand({id:"pubmed-search",name:"Search PubMed",callback:()=>{new u(this.app,this,"","pubmed").open()}}),this.addCommand({id:"arxiv-search",name:"Search ArXiv",callback:()=>{new u(this.app,this,"","arxiv").open()}}),this.addCommand({id:"wikipedia-search",name:"Search Wikipedia",callback:()=>{new u(this.app,this,"","wikipedia").open()}}),this.addSettingTab(new b(this.app,this))}async loadSettings(){this.settings=Object.assign({},f,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}},u=class extends n.Modal{constructor(e,t,i="",a="all"){super(e);this.results=[];this.plugin=t,this.query=i,this.source=a}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"Built Simple Research"});let i=e.createDiv({cls:"search-input-container"}).createEl("input",{type:"text",placeholder:"Enter search query...",value:this.query});i.style.width="100%",i.style.padding="8px",i.style.marginBottom="10px";let r=e.createDiv({cls:"source-selector"}).createEl("select");r.style.marginBottom="10px",[{value:"all",label:"All Sources"},{value:"pubmed",label:"PubMed"},{value:"arxiv",label:"ArXiv"},{value:"wikipedia",label:"Wikipedia"}].forEach(d=>{let m=r.createEl("option",{value:d.value,text:d.label});d.value===this.source&&(m.selected=!0)});let o=e.createEl("button",{text:"Search"});o.style.marginRight="10px",o.onclick=async()=>{let d=i.value,m=r.value;d&&await this.performSearch(d,m)};let p=e.createDiv({cls:"results-container"});p.id="search-results",this.query&&(i.value=this.query,this.performSearch(this.query,this.source))}async performSearch(e,t){let i=document.getElementById("search-results");if(!i)return;i.innerHTML="<p>Searching...</p>";let a=[],r=this.plugin.settings.maxResults;try{if((t==="all"||t==="pubmed")&&this.plugin.settings.pubmedEnabled){let l=await this.searchPubMed(e,r);a.push(...l.map(o=>({...o,source:"PubMed"})))}if((t==="all"||t==="arxiv")&&this.plugin.settings.arxivEnabled){let l=await this.searchArxiv(e,r);a.push(...l.map(o=>({...o,source:"ArXiv"})))}if((t==="all"||t==="wikipedia")&&this.plugin.settings.wikipediaEnabled){let l=await this.searchWikipedia(e,r);a.push(...l.map(o=>({...o,source:"Wikipedia"})))}this.displayResults(a,i)}catch(l){i.innerHTML=`<p style="color: red;">Error: ${l.message}</p>`}}async searchPubMed(e,t){return(await(0,n.requestUrl)({url:`https://pubmed.built-simple.ai/search?q=${encodeURIComponent(e)}&limit=${t}`,method:"GET"})).json.results||[]}async searchArxiv(e,t){return(await(0,n.requestUrl)({url:`https://arxiv.built-simple.ai/search?q=${encodeURIComponent(e)}&limit=${t}`,method:"GET"})).json.results||[]}async searchWikipedia(e,t){return(await(0,n.requestUrl)({url:`https://wikipedia.built-simple.ai/search?q=${encodeURIComponent(e)}&limit=${t}`,method:"GET"})).json.results||[]}displayResults(e,t){if(t.innerHTML="",e.length===0){t.createEl("p",{text:"No results found."});return}e.forEach(i=>{let a=t.createDiv({cls:"search-result"});a.style.padding="10px",a.style.marginBottom="10px",a.style.border="1px solid var(--background-modifier-border)",a.style.borderRadius="5px";let r=a.createEl("span",{text:i.source});r.style.fontSize="0.8em",r.style.padding="2px 6px",r.style.borderRadius="3px",r.style.backgroundColor="var(--interactive-accent)",r.style.color="var(--text-on-accent)",r.style.marginRight="8px";let l=a.createEl("strong",{text:i.title||"Untitled"});if(l.style.display="block",l.style.marginTop="5px",i.abstract||i.snippet||i.summary){let p=a.createEl("p",{text:(i.abstract||i.snippet||i.summary).substring(0,200)+"..."});p.style.fontSize="0.9em",p.style.color="var(--text-muted)"}let o=a.createEl("button",{text:"Insert Citation"});o.style.marginTop="5px",o.onclick=()=>{this.insertCitation(i)}})}insertCitation(e){let t=this.app.workspace.getActiveViewOfType(n.MarkdownView);if(t){let i=this.formatCitation(e);t.editor.replaceSelection(i),new n.Notice("Citation inserted!"),this.close()}}formatCitation(e){var o,p;let t=e.title||"Untitled",i=((o=e.authors)==null?void 0:o.join(", "))||"Unknown",a=e.year||((p=e.date)==null?void 0:p.substring(0,4))||"",r=e.url||e.link||"",l=e.source;return l==="PubMed"?`> **${t}**
> ${i} (${a})
> [PubMed](${r})

`:l==="ArXiv"?`> **${t}**
> ${i} (${a})
> [ArXiv](${r})

`:`> **${t}**
> [Wikipedia](${r})

`}onClose(){let{contentEl:e}=this;e.empty()}},b=class extends n.PluginSettingTab{constructor(s,e){super(s,e),this.plugin=e}display(){let{containerEl:s}=this;s.empty(),s.createEl("h2",{text:"Built Simple Research Settings"}),new n.Setting(s).setName("Enable PubMed").setDesc("Search biomedical literature from PubMed").addToggle(e=>e.setValue(this.plugin.settings.pubmedEnabled).onChange(async t=>{this.plugin.settings.pubmedEnabled=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Enable ArXiv").setDesc("Search preprints from ArXiv").addToggle(e=>e.setValue(this.plugin.settings.arxivEnabled).onChange(async t=>{this.plugin.settings.arxivEnabled=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Enable Wikipedia").setDesc("Search Wikipedia articles").addToggle(e=>e.setValue(this.plugin.settings.wikipediaEnabled).onChange(async t=>{this.plugin.settings.wikipediaEnabled=t,await this.plugin.saveSettings()})),new n.Setting(s).setName("Max Results").setDesc("Maximum number of results per source").addSlider(e=>e.setLimits(1,20,1).setValue(this.plugin.settings.maxResults).setDynamicTooltip().onChange(async t=>{this.plugin.settings.maxResults=t,await this.plugin.saveSettings()}))}};
